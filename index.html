<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lezzet Durağı</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Montserrat & Poppins -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600;700&family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        .font-poppins { font-family: 'Poppins', sans-serif; }
        .font-montserrat { font-family: 'Montserrat', sans-serif; }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #0c0a09;
        }
        .container {
            max-width: 1200px;
        }
        .item-card {
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.2);
            transition: transform 0.4s cubic-bezier(0.25, 0.8, 0.25, 1), box-shadow 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            background: linear-gradient(145deg, #1a1a1a, #2c2c2c);
        }
        .item-card:hover {
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.3);
            transform: translateY(-10px) scale(1.02);
        }
        .tab-button.active {
            background-color: #ffc107;
            color: #1a202c;
            transform: scale(1.1);
            box-shadow: 0 4px 20px rgba(255, 193, 7, 0.4);
        }
        .order-summary {
            position: sticky;
            top: 2rem;
        }
        .hidden {
            display: none;
        }
        .loader {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ffc107;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        /* Özel buton animasyonu */
        .btn-hover-effect {
            transition: all 0.3s ease-in-out;
        }
        .btn-hover-effect:hover {
            transform: scale(1.05);
            box-shadow: 0 6px 15px rgba(255, 193, 7, 0.3);
        }
        /* Responsive ve temel tasarım kuralları */
        .modal-content {
            width: 90%;
            max-width: 500px;
        }
        @media (min-width: 768px) {
            .modal-content {
                width: 70%;
            }
        }
        .status-badge {
            font-weight: 600;
            padding: 0.2rem 0.6rem;
            border-radius: 9999px;
            text-transform: uppercase;
            font-size: 0.875rem;
            letter-spacing: 0.05em;
        }
        .status-preparing {
            background-color: #fde68a;
            color: #92400e;
        }
        .status-ready {
            background-color: #a7f3d0;
            color: #065f46;
        }
    </style>
</head>
<body class="bg-zinc-900 text-white min-h-screen p-4 flex flex-col items-center">

    <div id="loader-overlay" class="fixed inset-0 bg-zinc-900 bg-opacity-75 z-[60] flex items-center justify-center">
        <div class="flex flex-col items-center space-y-4 text-white">
            <div class="loader"></div>
            <p class="text-lg font-poppins">Yükleniyor...</p>
        </div>
    </div>

    <!-- Masa Seçim Modal -->
    <div id="table-modal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm z-[70] flex items-center justify-center hidden">
        <div class="bg-zinc-800 p-8 rounded-2xl w-full max-w-sm mx-4 text-center relative border border-zinc-700 shadow-xl modal-content">
            <h2 class="text-3xl font-bold text-amber-500 mb-4 font-montserrat">Masa Numaranızı Girin</h2>
            <p class="text-zinc-400 mb-6 font-poppins">Lütfen siparişinizin geleceği masa numarasını giriniz.</p>
            <input id="table-input" type="number" placeholder="Masa No" class="w-full bg-zinc-700 text-white p-3 rounded-lg text-center text-xl font-bold focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all duration-300 font-montserrat">
            <button id="set-table-btn" class="w-full mt-6 py-3 rounded-full bg-amber-500 text-black font-bold text-lg hover:bg-amber-600 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed btn-hover-effect">Masayı Onayla</button>
        </div>
    </div>

    <!-- Çalışan Giriş Modal -->
    <div id="staff-login-modal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm z-[70] flex items-center justify-center hidden">
        <div class="bg-zinc-800 p-8 rounded-2xl w-full max-w-sm mx-4 text-center relative border border-zinc-700 shadow-xl modal-content">
            <button id="close-login-modal" class="absolute top-4 right-4 text-zinc-400 hover:text-white transition-colors duration-200 text-2xl font-bold">&times;</button>
            <h2 class="text-3xl font-bold text-amber-500 mb-4 font-montserrat">Çalışan Girişi</h2>
            <p class="text-zinc-400 mb-6 font-poppins">Lütfen yönetici şifresini giriniz.</p>
            <input id="staff-password-input" type="password" placeholder="Şifre" class="w-full bg-zinc-700 text-white p-3 rounded-lg text-center text-xl font-bold focus:outline-none focus:ring-2 focus:ring-amber-500 transition-all duration-300 font-montserrat">
            <p id="login-message" class="text-red-500 mt-2 text-sm hidden">Yanlış şifre.</p>
            <button id="staff-login-btn" class="w-full mt-6 py-3 rounded-full bg-amber-500 text-black font-bold text-lg hover:bg-amber-600 transition-all duration-300 btn-hover-effect">Giriş Yap</button>
        </div>
    </div>

    <!-- Destek Çağrısı Onay Mesajı -->
    <div id="support-call-success-modal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-zinc-800 p-8 rounded-2xl w-full max-w-sm mx-4 text-center relative border border-zinc-700 shadow-xl modal-content">
            <h2 class="text-3xl font-bold text-emerald-500 mb-4 font-montserrat">Personel Yolda!</h2>
            <p class="text-zinc-400 mb-6 font-poppins">Destek talebiniz alındı. En kısa sürede size ulaşacağız.</p>
            <button id="close-support-modal" class="w-full py-3 rounded-full bg-emerald-500 text-black font-bold text-lg hover:bg-emerald-600 transition-all duration-300 btn-hover-effect">Tamam</button>
        </div>
    </div>
    
    <!-- Sipariş Hazır Modal -->
    <div id="ready-modal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm z-[70] flex items-center justify-center hidden">
        <div class="bg-zinc-800 p-8 rounded-2xl w-full max-w-sm mx-4 text-center relative border border-zinc-700 shadow-xl modal-content">
            <button id="close-ready-modal" class="absolute top-4 right-4 text-zinc-400 hover:text-white transition-colors duration-200 text-2xl font-bold">&times;</button>
            <h2 class="text-3xl font-bold text-amber-500 mb-4 font-montserrat">Siparişiniz Hazır!</h2>
            <p class="text-zinc-400 mb-6 font-poppins">Lütfen siparişinizi baristadan teslim alınız.</p>
            <p id="ready-order-id" class="text-xl font-semibold text-white font-poppins mb-4"></p>
            <button id="close-ready-modal-btn" class="w-full py-3 rounded-full bg-amber-500 text-black font-bold text-lg hover:bg-amber-600 transition-all duration-300 btn-hover-effect">Anladım</button>
        </div>
    </div>

    <div class="container mx-auto p-6 md:p-10 rounded-3xl space-y-8 bg-zinc-900">
        <!-- Başlık Bölümü -->
        <div class="text-center space-y-4">
            <h1 class="text-5xl font-extrabold text-amber-500 tracking-wide font-montserrat">Lezzet Durağı</h1>
            <p id="app-subtitle" class="text-zinc-400 text-lg font-medium font-poppins">Siparişinizi oluşturmak için lezzetleri keşfedin.</p>
            <p id="current-table-display" class="text-lg font-semibold text-amber-500 hidden font-poppins">Masa No: <span id="table-number-text"></span></p>
            <p id="userIdDisplay" class="text-sm text-zinc-600 hidden">Kullanıcı ID: </p>
        </div>

        <!-- Görünüm Değiştirme Butonları -->
        <div class="flex justify-center gap-4 flex-wrap">
            <button id="customer-view-btn" class="px-4 py-2 rounded-full font-semibold transition-all duration-300 btn-hover-effect bg-amber-500 text-black">Müşteri Görünümü</button>
            <button id="staff-view-btn" class="px-4 py-2 rounded-full font-semibold transition-all duration-300 btn-hover-effect bg-zinc-800 text-zinc-400 hover:bg-zinc-700">Çalışan Görünümü</button>
        </div>

        <!-- Müşteri Görünümü -->
        <div id="customer-view" class="">
            <!-- Sipariş Durumu Kartı -->
            <div id="order-status-card" class="bg-zinc-800 p-6 rounded-2xl shadow-lg border border-zinc-700 hidden">
                <h2 class="text-xl font-bold text-amber-500 mb-4 text-center">Sipariş Durumu</h2>
                <div id="current-order-display" class="text-center">
                    <!-- Sipariş durumu buraya eklenecek -->
                </div>
            </div>

            <!-- Kategori Butonları -->
            <div class="flex justify-center gap-4 md:gap-8 flex-wrap mt-8">
                <button class="tab-button active px-6 py-2 rounded-full font-semibold transition-all duration-300 btn-hover-effect bg-zinc-800 hover:bg-zinc-700 text-zinc-400" data-tab="kahveler">☕ Kahveler</button>
                <button class="tab-button px-6 py-2 rounded-full font-semibold transition-all duration-300 btn-hover-effect bg-zinc-800 hover:bg-zinc-700 text-zinc-400" data-tab="tatlilar">🍰 Tatlılar</button>
                <button class="tab-button px-6 py-2 rounded-full font-semibold transition-all duration-300 btn-hover-effect bg-zinc-800 hover:bg-zinc-700 text-zinc-400" data-tab="sandvicler">🥪 Sandviçler</button>
                <button class="tab-button px-6 py-2 rounded-full font-semibold transition-all duration-300 btn-hover-effect bg-zinc-800 hover:bg-zinc-700 text-zinc-400" data-tab="icecekler">🍹 İçecekler</button>
            </div>

            <!-- Menü ve Sipariş Özeti Bölümü -->
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mt-12">
                <!-- Menü İçeriği -->
                <div class="lg:col-span-2 space-y-8">
                    <div id="menu-content" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <!-- Menü Öğeleri Buraya JS ile Eklenecek -->
                    </div>
                </div>

                <!-- Sipariş Özeti -->
                <div class="lg:col-span-1 p-6 rounded-3xl bg-zinc-800 order-summary h-fit shadow-lg border border-zinc-700">
                    <h2 class="text-2xl font-bold text-amber-500 mb-4 text-center border-b-2 border-zinc-700 pb-2 font-montserrat">Sipariş Özeti</h2>
                    <ul id="cart-items" class="space-y-4 font-poppins">
                        <li class="text-center text-zinc-400">Sepetiniz şu anda boş.</li>
                    </ul>
                    <div class="mt-6 pt-4 border-t-2 border-zinc-700 flex justify-between items-center">
                        <span class="text-xl font-bold text-white font-montserrat">Toplam:</span>
                        <span id="total-price" class="text-2xl font-bold text-amber-500 font-montserrat">0 TL</span>
                    </div>
                    <button id="order-button" class="w-full mt-6 py-3 rounded-full bg-amber-500 text-black font-bold text-lg shadow-lg hover:bg-amber-600 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed btn-hover-effect">Siparişi Tamamla</button>
                    <button id="call-support-button" class="w-full mt-4 py-3 rounded-full bg-sky-500 text-white font-bold text-lg hover:bg-sky-600 transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed btn-hover-effect">Destek Çağır</button>
                </div>
            </div>
        </div>

        <!-- Çalışan Görünümü -->
        <div id="staff-view" class="hidden">
            <h2 class="text-3xl font-bold text-center text-amber-500 mb-6 font-montserrat">Canlı Sipariş Paneli</h2>
            <div id="live-orders-list" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <!-- Hazırlanan siparişler buraya JS ile eklenecek -->
            </div>
            
            <div class="mt-12">
                <h2 class="text-3xl font-bold text-center text-amber-500 mb-6 font-montserrat">Hazır Siparişler</h2>
                <div id="ready-orders-list" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                     <!-- Hazır siparişler buraya JS ile eklenecek -->
                </div>
            </div>

            <div class="mt-12">
                <h2 class="text-3xl font-bold text-center text-sky-500 mb-6 font-montserrat">Destek Çağrıları</h2>
                <div id="support-calls-list" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Destek çağrıları buraya JS ile eklenecek -->
                </div>
            </div>

            <div class="mt-12">
                <h2 class="text-3xl font-bold text-center text-zinc-400 mb-6 font-montserrat">Geçmiş Siparişler</h2>
                <div id="past-orders-list" class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Tamamlanan siparişler buraya JS ile eklenecek -->
                </div>
            </div>
        </div>
    </div>

    <!-- Ürün Detay Modal -->
    <div id="item-modal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-zinc-800 p-8 rounded-2xl w-full max-w-lg mx-4 text-center relative border border-zinc-700 shadow-xl modal-content">
            <button id="close-modal" class="absolute top-4 right-4 text-zinc-400 hover:text-white transition-colors duration-200 text-2xl font-bold">&times;</button>
            <div id="modal-content">
                <div id="modal-image-placeholder" class="bg-zinc-700 w-32 h-32 rounded-full mx-auto mb-4 flex items-center justify-center">
                    <span id="modal-emoji" class="text-6xl"></span>
                </div>
                <h3 id="modal-title" class="text-3xl font-bold text-amber-500 mb-2 font-montserrat"></h3>
                <p id="modal-description" class="text-zinc-400 mb-4 font-poppins"></p>
                <div id="modal-options" class="space-y-4 text-left mt-6 font-poppins">
                    <!-- Seçenekler buraya eklenecek -->
                </div>
                <div class="flex items-center justify-center gap-4 mt-6">
                    <button id="decrease-quantity-modal" class="bg-zinc-700 text-white rounded-full w-8 h-8 flex items-center justify-center font-bold text-xl hover:bg-zinc-600 transition-colors duration-300 btn-hover-effect">-</button>
                    <span id="modal-quantity" class="text-xl font-bold font-montserrat">1</span>
                    <button id="increase-quantity-modal" class="bg-amber-500 text-black rounded-full w-8 h-8 flex items-center justify-center font-bold text-xl hover:bg-amber-600 transition-colors duration-300 btn-hover-effect">+</button>
                </div>
                <span id="modal-price" class="text-2xl font-bold text-white mt-4 block font-montserrat"></span>
                <button id="add-to-cart-button" class="mt-6 w-full py-3 rounded-full bg-amber-500 text-black font-bold text-lg hover:bg-amber-600 transition-colors duration-300 btn-hover-effect">Sepete Ekle</button>
            </div>
        </div>
    </div>

    <!-- Sipariş Onay Modal -->
    <div id="order-modal" class="fixed inset-0 bg-black bg-opacity-80 backdrop-blur-sm z-50 flex items-center justify-center hidden">
        <div class="bg-zinc-800 p-8 rounded-2xl w-full max-w-lg mx-4 text-center relative border border-zinc-700 shadow-xl modal-content">
            <h2 class="text-3xl font-bold text-amber-500 mb-4 font-montserrat">Siparişiniz Alındı!</h2>
            <p class="text-zinc-400 mb-6 font-poppins">Sipariş detaylarınız aşağıda. En kısa sürede hazırlanıp size ulaştırılacak. Afiyet olsun!</p>
            <p class="text-zinc-400 mb-6 font-poppins">Sipariş Numarası: <span id="order-id" class="font-bold text-white"></span></p>
            <ul id="order-summary-list" class="text-left space-y-2 text-zinc-300 border-t border-b border-zinc-700 py-4 mb-4 font-poppins">
                <!-- Sipariş ürünleri buraya eklenecek -->
            </ul>
            <div class="flex justify-between items-center text-xl font-bold mb-6">
                <span class="font-montserrat">Toplam Tutar:</span>
                <span id="order-total-price" class="text-amber-500 font-montserrat"></span>
            </div>
            <button id="close-order-modal" class="w-full py-3 rounded-full bg-amber-500 text-black font-bold text-lg hover:bg-amber-600 transition-colors duration-300 btn-hover-effect">Tamam</button>
        </div>
    </div>

    <script>
        // Uygulama Durumu ve Veri Yönetimi
        const menuData = {
            kahveler: [
                { id: 'espresso', name: 'Espresso', price: 45, description: 'Yoğun aromalı, sert kahve.', emoji: '☕' },
                { id: 'latte', name: 'Latte', price: 60, description: 'Süt ve köpükle yumuşatılmış, katmanlı.', emoji: '🥛', options: {
                    Sıcaklık: [{ name: 'Sıcak', price: 0, emoji: '🔥' }, { name: 'Soğuk', price: 0, emoji: '🧊' }],
                    'Süt Tipi': [{ name: 'Normal Süt', price: 0 }, { name: 'Laktozsuz Süt', price: 15 }, { name: 'Badem Sütü', price: 15 }]
                }},
                { id: 'cappuccino', name: 'Cappuccino', price: 55, description: 'Zengin köpüklü, yumuşak içim.', emoji: '☕' },
                { id: 'americano', name: 'Americano', price: 48, description: 'Amerikan usulü demlenmiş, sıcak su ile seyreltilmiş.', emoji: '☕' },
                { id: 'mojito_coffee', name: 'Naneli Buzlu Kahve', price: 70, description: 'Yaz aylarına özel, naneli ve ferahlatıcı.', emoji: '🍃' },
            ],
            tatlilar: [
                { id: 'sufle', name: 'Çikolatalı Sufle', price: 80, description: 'Sıcak, akışkan çikolata hazzı.', emoji: '🍮' },
                { id: 'cheesecake', name: 'San Sebastian Cheesecake', price: 90, description: 'İçi akışkan, hafif ve lezzetli.', emoji: '🍰' },
                { id: 'profiterol', name: 'Profiterol', price: 75, description: 'Krema dolgulu, çikolata soslu efsane tatlı.', emoji: '🍫' },
                { id: 'tiramisu', name: 'Tiramisu', price: 85, description: 'Kahve ve mascarpone kreması ile İtalyan klasiği.', emoji: '☕' },
            ],
            sandvicler: [
                { id: 'pesto', name: 'Mozzarella Pesto', price: 95, description: 'Fesleğenli pesto sos ve taze mozzarella.', emoji: '🥪' },
                { id: 'club', name: 'Kulüp Sandviç', price: 120, description: 'Tavuk, hindi füme ve marul ile bol malzemeli.', emoji: '🥓' },
                { id: 'vegan', name: 'Vegan Sandviç', price: 110, description: 'Taze sebzeler ve avokado ile sağlıklı tercih.', emoji: '🥗' },
                { id: 'tonbalik', name: 'Ton Balıklı Sandviç', price: 105, description: 'Taze sebzelerle zenginleştirilmiş.', emoji: '🐟' },
            ],
            icecekler: [
                { id: 'limonata', name: 'Ev Yapımı Limonata', price: 55, description: 'Naneli ve ferahlatıcı.', emoji: '🍹', options: {
                    Tat: [{name: 'Klasik', price: 0}, {name: 'Naneli', price: 5}, {name: 'Çilekli', price: 5}]
                }},
                { id: 'frozen', name: 'Frozen', price: 70, description: 'Çilek veya mango seçenekleriyle buzlu içecek.', emoji: '🥤', options: {
                    Tat: [{name: 'Çilek', price: 0}, {name: 'Limon', price: 0}, {name: 'Tropikal Meyve', price: 10}, {name: 'Ahududu', price: 10}]
                }},
                { id: 'ice_tea', name: 'Ice Tea', price: 40, description: 'Şeftali veya limon aromalı, serinletici.', emoji: '🧊', options: {
                    Tat: [{name: 'Şeftali', price: 0}, {name: 'Limon', price: 0}, {name: 'Ahududu', price: 5}, {name: 'Yeşil Çay', price: 5}]
                }},
                { id: 'milkshake', name: 'Milkshake', price: 80, description: 'Çikolata, çilek ve vanilya aromalı.', emoji: '🍦', options: {
                    Tat: [{name: 'Çikolata', price: 0}, {name: 'Çilek', price: 0}, {name: 'Vanilya', price: 0}, {name: 'Muz', price: 10}, {name: 'Karamel', price: 10}]
                }},
            ]
        };
        
        let cart = {};
        let selectedItem = null;
        let selectedItemQuantity = 1;
        let selectedOptions = {};
        let selectedTable = null;
        let currentView = 'customer';
        const staffPassword = '1234';
        
        // Sipariş ve destek çağrıları için basit bir yerel "veritabanı"
        let localOrders = [];
        let localSupportCalls = [];
        let lastPlacedOrderId = null;

        // --- DOM Elementleri ve Fonksiyon Referansları ---
        const dom = {
            loaderOverlay: document.getElementById('loader-overlay'),
            appSubtitle: document.getElementById('app-subtitle'),
            customerViewBtn: document.getElementById('customer-view-btn'),
            staffViewBtn: document.getElementById('staff-view-btn'),
            customerView: document.getElementById('customer-view'),
            staffView: document.getElementById('staff-view'),
            cartItemsList: document.getElementById('cart-items'),
            totalPriceEl: document.getElementById('total-price'),
            menuContent: document.getElementById('menu-content'),
            tabButtons: document.querySelectorAll('.tab-button'),
            itemModal: document.getElementById('item-modal'),
            closeModalButton: document.getElementById('close-modal'),
            addToCartButton: document.getElementById('add-to-cart-button'),
            orderButton: document.getElementById('order-button'),
            orderModal: document.getElementById('order-modal'),
            closeOrderModal: document.getElementById('close-order-modal'),
            orderSummaryList: document.getElementById('order-summary-list'),
            orderTotalPriceEl: document.getElementById('order-total-price'),
            modalQuantityEl: document.getElementById('modal-quantity'),
            increaseQuantityModalBtn: document.getElementById('increase-quantity-modal'),
            decreaseQuantityModalBtn: document.getElementById('decrease-quantity-modal'),
            liveOrdersList: document.getElementById('live-orders-list'),
            readyOrdersList: document.getElementById('ready-orders-list'),
            pastOrdersList: document.getElementById('past-orders-list'),
            tableModal: document.getElementById('table-modal'),
            tableInput: document.getElementById('table-input'),
            setTableBtn: document.getElementById('set-table-btn'),
            currentTableDisplay: document.getElementById('current-table-display'),
            tableNumberText: document.getElementById('table-number-text'),
            modalOptionsEl: document.getElementById('modal-options'),
            staffLoginModal: document.getElementById('staff-login-modal'),
            staffPasswordInput: document.getElementById('staff-password-input'),
            staffLoginBtn: document.getElementById('staff-login-btn'),
            closeLoginModal: document.getElementById('close-login-modal'),
            loginMessageEl: document.getElementById('login-message'),
            callSupportBtn: document.getElementById('call-support-button'),
            supportCallsList: document.getElementById('support-calls-list'),
            supportCallSuccessModal: document.getElementById('support-call-success-modal'),
            closeSupportModalBtn: document.getElementById('close-support-modal'),
            readyModal: document.getElementById('ready-modal'),
            closeReadyModalBtn: document.getElementById('close-ready-modal-btn'),
            orderStatusCard: document.getElementById('order-status-card'),
            currentOrderDisplay: document.getElementById('current-order-display'),
            userIdDisplay: document.getElementById('userIdDisplay'),
        };

        // --- Yerel Depolama İşlevleri ---
        function saveToLocalStorage(key, data) {
            localStorage.setItem(key, JSON.stringify(data));
        }

        function getFromLocalStorage(key, defaultValue) {
            try {
                const data = localStorage.getItem(key);
                return data ? JSON.parse(data) : defaultValue;
            } catch (e) {
                console.error("Local Storage'dan veri okuma hatası:", e);
                return defaultValue;
            }
        }
        
        function updateLocalData() {
            localOrders = getFromLocalStorage('orders', []);
            localSupportCalls = getFromLocalStorage('support_calls', []);
            lastPlacedOrderId = getFromLocalStorage('last_order_id', null);
            if (currentView === 'staff') {
                renderAllStaffViews();
            } else {
                updateCustomerView();
            }
        }

        // --- Yardımcı Fonksiyonlar ---
        function formatPrice(price) {
            return `${price} TL`;
        }

        function calculateItemTotalPrice(item, quantity, options) {
            let optionsTotal = 0;
            if (options) {
                for (const key in options) {
                    optionsTotal += options[key].price;
                }
            }
            return (item.price + optionsTotal) * quantity;
        }

        function showModal(modalElement) {
            modalElement.classList.remove('hidden');
        }

        function hideModal(modalElement) {
            modalElement.classList.add('hidden');
        }

        function addToCart() {
            if (!selectedItem) return;

            const itemInCart = cart[selectedItem.id];
            const totalPrice = calculateItemTotalPrice(selectedItem, selectedItemQuantity, selectedOptions);

            if (itemInCart) {
                itemInCart.quantity += selectedItemQuantity;
                itemInCart.totalPrice += totalPrice;
            } else {
                cart[selectedItem.id] = {
                    ...selectedItem,
                    quantity: selectedItemQuantity,
                    selectedOptions: selectedOptions,
                    totalPrice: totalPrice,
                };
            }
            hideModal(dom.itemModal);
            updateCart();
        }

        // --- UI Güncelleme Fonksiyonları ---
        function updateCart() {
            dom.cartItemsList.innerHTML = '';
            let total = 0;
            const itemsInCart = Object.values(cart).filter(item => item.quantity > 0);

            if (itemsInCart.length === 0) {
                dom.cartItemsList.innerHTML = '<li class="text-center text-zinc-400 font-poppins">Sepetiniz şu anda boş.</li>';
                dom.orderButton.disabled = true;
            } else {
                dom.orderButton.disabled = !selectedTable;
                itemsInCart.forEach(item => {
                    const li = document.createElement('li');
                    li.classList.add('flex', 'justify-between', 'items-center', 'py-2', 'border-b', 'border-zinc-700', 'last:border-b-0');
                    
                    let optionsText = '';
                    if (item.selectedOptions) {
                        for (const key in item.selectedOptions) {
                            const option = item.selectedOptions[key];
                            optionsText += `<span class="text-xs text-zinc-500 block font-poppins">${key}: ${option.name} ${option.price > 0 ? '(+' + option.price + ' TL)' : ''}</span>`;
                        }
                    }

                    li.innerHTML = `
                        <div class="flex-1">
                            <h4 class="font-semibold text-white font-montserrat">${item.name}</h4>
                            ${optionsText}
                            <span class="text-sm text-zinc-400 font-poppins">Adet: ${item.quantity}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <button data-id="${item.id}" class="decrease-cart-btn bg-zinc-700 text-white rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm hover:bg-zinc-600 transition-colors duration-300">-</button>
                            <span class="text-base font-bold font-montserrat">${item.quantity}</span>
                            <button data-id="${item.id}" class="increase-cart-btn bg-amber-500 text-black rounded-full w-6 h-6 flex items-center justify-center font-bold text-sm hover:bg-amber-600 transition-colors duration-300">+</button>
                        </div>
                        <span class="font-bold text-amber-500 ml-4 font-montserrat">${formatPrice(item.totalPrice)}</span>
                    `;
                    dom.cartItemsList.appendChild(li);
                    total += item.totalPrice;
                });
            }
            dom.totalPriceEl.textContent = formatPrice(total);
        }

        function renderMenu(category) {
            dom.menuContent.innerHTML = '';
            menuData[category].forEach(item => {
                const itemCard = document.createElement('div');
                itemCard.classList.add('item-card', 'p-6', 'rounded-2xl', 'bg-zinc-800', 'flex', 'flex-col', 'gap-4', 'items-center', 'text-center', 'cursor-pointer');
                itemCard.innerHTML = `
                    <span class="text-6xl">${item.emoji}</span>
                    <h3 class="text-2xl font-bold text-white font-montserrat">${item.name}</h3>
                    <p class="text-sm text-zinc-400 line-clamp-2 font-poppins">${item.description}</p>
                    <span class="font-bold text-amber-500 text-xl mt-auto font-montserrat">${formatPrice(item.price)}</span>
                `;
                itemCard.addEventListener('click', () => showItemModal(item));
                dom.menuContent.appendChild(itemCard);
            });
        }
        
        function showItemModal(item) {
            selectedItem = item;
            selectedItemQuantity = 1;
            selectedOptions = {};
            
            document.getElementById('modal-emoji').textContent = item.emoji;
            document.getElementById('modal-title').textContent = item.name;
            document.getElementById('modal-description').textContent = item.description;
            dom.modalQuantityEl.textContent = selectedItemQuantity;
            
            dom.modalOptionsEl.innerHTML = '';
            if (item.options) {
                for (const optionCategory in item.options) {
                    const categoryDiv = document.createElement('div');
                    categoryDiv.classList.add('mb-4');
                    categoryDiv.innerHTML = `<h4 class="font-semibold text-white mb-2 font-montserrat">${optionCategory}:</h4>`;

                    const optionsContainer = document.createElement('div');
                    optionsContainer.classList.add('flex', 'flex-wrap', 'gap-2');

                    item.options[optionCategory].forEach((option, index) => {
                        const optionId = `option-${optionCategory}-${index}`;
                        const isDefault = index === 0;
                        if (isDefault) {
                            selectedOptions[optionCategory] = option;
                        }

                        const optionInput = document.createElement('input');
                        optionInput.type = 'radio';
                        optionInput.name = optionCategory;
                        optionInput.id = optionId;
                        optionInput.value = option.name;
                        optionInput.checked = isDefault;
                        optionInput.classList.add('hidden');

                        const optionLabel = document.createElement('label');
                        optionLabel.htmlFor = optionId;
                        optionLabel.classList.add('px-4', 'py-2', 'rounded-full', 'font-semibold', 'transition-all', 'duration-200', 'cursor-pointer', 'bg-zinc-700', 'text-white', 'hover:bg-amber-500', 'hover:text-black', 'text-sm');
                        optionLabel.textContent = `${option.emoji ? option.emoji + ' ' : ''}${option.name} ${option.price > 0 ? '(+' + option.price + ' TL)' : ''}`;

                        optionInput.addEventListener('change', () => {
                            selectedOptions[optionCategory] = option;
                            updateModalPrice();
                        });

                        optionsContainer.appendChild(optionInput);
                        optionsContainer.appendChild(optionLabel);
                    });
                    categoryDiv.appendChild(optionsContainer);
                    dom.modalOptionsEl.appendChild(categoryDiv);
                }
            }
            updateModalPrice();
            showModal(dom.itemModal);
        }

        function updateModalPrice() {
            const total = calculateItemTotalPrice(selectedItem, selectedItemQuantity, selectedOptions);
            document.getElementById('modal-price').textContent = formatPrice(total);
        }

        function renderOrders(container, orders) {
            container.innerHTML = '';
            if (orders.length === 0) {
                container.innerHTML = `<p class="text-center text-zinc-400 col-span-2 font-poppins">Henüz sipariş yok.</p>`;
                return;
            }
            orders.forEach(order => {
                const orderCard = createOrderCard(order);
                container.appendChild(orderCard);
            });
        }
        
        function createOrderCard(order) {
            const orderCard = document.createElement('div');
            orderCard.classList.add('p-6', 'rounded-2xl', 'bg-zinc-800', 'shadow-lg', 'border', 'border-zinc-700', 'space-y-4');
            let statusColor = '';
            let buttonHtml = '';

            if (order.status === 'preparing') {
                statusColor = 'bg-amber-500';
                buttonHtml = `<button data-id="${order.id}" data-action="mark-as-ready" class="w-full mt-4 py-2 rounded-full bg-emerald-500 text-white font-bold hover:bg-emerald-600 transition-colors duration-300 btn-hover-effect">Hazırlandı</button>`;
            } else if (order.status === 'ready') {
                statusColor = 'bg-emerald-500';
                buttonHtml = `<button data-id="${order.id}" data-action="complete-order" class="w-full mt-4 py-2 rounded-full bg-sky-500 text-white font-bold hover:bg-sky-600 transition-colors duration-300 btn-hover-effect">Teslim Edildi</button>`;
            } else if (order.status === 'completed') {
                statusColor = 'bg-zinc-500';
            }

            const items = order.items;
            let itemsHtml = '';
            items.forEach(item => {
                let optionsText = '';
                if (item.selectedOptions) {
                    for (const key in item.selectedOptions) {
                        const option = item.selectedOptions[key];
                        optionsText += `<li class="text-xs text-zinc-500 ml-4 font-poppins">${key}: ${option.name} ${option.price > 0 ? '(+' + option.price + ' TL)' : ''}</li>`;
                    }
                }
                itemsHtml += `<li class="text-zinc-300 font-poppins">${item.name} (${item.quantity} adet) - ${formatPrice(item.totalPrice)}</li><ul class="font-poppins">${optionsText}</ul>`;
            });

            orderCard.innerHTML = `
                <div class="flex justify-between items-center border-b border-zinc-700 pb-2">
                    <h3 class="text-xl font-bold text-white font-montserrat">Sipariş ID: <span class="font-normal text-amber-500 text-sm font-poppins">${order.orderId}</span></h3>
                    <span class="px-3 py-1 text-sm rounded-full font-bold ${statusColor} text-white font-poppins">${order.status === 'preparing' ? 'Hazırlanıyor' : (order.status === 'ready' ? 'Hazırlandı' : 'Tamamlandı')}</span>
                </div>
                <p class="text-sm text-zinc-400 font-poppins">Masa No: <span class="text-white font-bold">${order.tableNumber}</span></p>
                <ul class="list-disc list-inside space-y-1">
                    ${itemsHtml}
                </ul>
                <div class="pt-2 border-t border-zinc-700 flex justify-between items-center">
                    <span class="text-lg font-bold font-montserrat">Toplam:</span>
                    <span class="text-xl font-bold text-amber-500 font-montserrat">${formatPrice(order.total)}</span>
                </div>
                ${buttonHtml}
            `;
            return orderCard;
        }

        function createSupportCallCard(call) {
             const callCard = document.createElement('div');
             callCard.classList.add('p-6', 'rounded-2xl', 'bg-zinc-800', 'shadow-lg', 'border', 'border-sky-700', 'space-y-4');
             const callTime = new Date(call.timestamp).toLocaleTimeString('tr-TR', { hour: '2-digit', minute: '2-digit' });

             callCard.innerHTML = `
                 <div class="flex justify-between items-center border-b border-sky-700 pb-2">
                     <h3 class="text-xl font-bold text-white font-montserrat">Masa No: <span class="text-sky-500">${call.tableNumber}</span></h3>
                     <span class="text-sm text-zinc-400 font-poppins">${callTime}</span>
                 </div>
                 <p class="text-zinc-300 font-poppins">Personel desteği talep edildi.</p>
                 <button data-id="${call.id}" data-action="resolve-support" class="w-full mt-4 py-2 rounded-full bg-emerald-500 text-white font-bold hover:bg-emerald-600 transition-colors duration-300 btn-hover-effect">Sorun Çözüldü</button>
             `;
             return callCard;
        }
        
        function renderSupportCalls(calls) {
            dom.supportCallsList.innerHTML = '';
            if (calls.length === 0) {
                dom.supportCallsList.innerHTML = '<p class="text-center text-zinc-400 col-span-2 font-poppins">Bekleyen destek çağrısı yok.</p>';
                return;
            }
            calls.forEach(call => {
                dom.supportCallsList.appendChild(createSupportCallCard(call));
            });
        }

        function renderAllStaffViews() {
            const liveOrders = localOrders.filter(order => order.status === 'preparing');
            const readyOrders = localOrders.filter(order => order.status === 'ready');
            const pastOrders = localOrders.filter(order => order.status === 'completed');

            renderOrders(dom.liveOrdersList, liveOrders);
            renderOrders(dom.readyOrdersList, readyOrders);
            renderOrders(dom.pastOrdersList, pastOrders);
            renderSupportCalls(localSupportCalls);
        }

        function setView(viewName) {
            currentView = viewName;
            const isCustomer = viewName === 'customer';
            dom.customerView.classList.toggle('hidden', !isCustomer);
            dom.staffView.classList.toggle('hidden', isCustomer);
            dom.customerViewBtn.classList.toggle('bg-amber-500', isCustomer);
            dom.customerViewBtn.classList.toggle('text-black', isCustomer);
            dom.customerViewBtn.classList.toggle('bg-zinc-800', !isCustomer);
            dom.customerViewBtn.classList.toggle('text-zinc-400', !isCustomer);
            dom.customerViewBtn.classList.toggle('hover:bg-zinc-700', !isCustomer);
            dom.staffViewBtn.classList.toggle('bg-amber-500', !isCustomer);
            dom.staffViewBtn.classList.toggle('text-black', !isCustomer);
            dom.staffViewBtn.classList.toggle('bg-zinc-800', isCustomer);
            dom.staffViewBtn.classList.toggle('text-zinc-400', isCustomer);
            dom.staffViewBtn.classList.toggle('hover:bg-zinc-700', isCustomer);
            
            dom.appSubtitle.textContent = isCustomer ? "Siparişinizi oluşturmak için lezzetleri keşfedin." : "Canlı Sipariş Paneli";
            dom.currentTableDisplay.classList.toggle('hidden', !isCustomer);
            dom.callSupportBtn.disabled = !selectedTable;

            updateLocalData();
        }
        
        function updateCustomerView() {
            if (lastPlacedOrderId) {
                const order = localOrders.find(o => o.id === lastPlacedOrderId);
                if (order) {
                    displayCustomerOrderStatus(order);
                    if (order.status === 'ready') {
                        showModal(dom.readyModal);
                        document.getElementById('ready-order-id').textContent = order.orderId;
                    }
                } else {
                    // Sipariş tamamlandı ve yerelden silindi
                    dom.orderStatusCard.classList.add('hidden');
                    lastPlacedOrderId = null;
                    saveToLocalStorage('last_order_id', null);
                    dom.orderButton.disabled = false;
                }
            } else {
                dom.orderStatusCard.classList.add('hidden');
            }
        }
        
        function displayCustomerOrderStatus(order) {
            dom.orderStatusCard.classList.remove('hidden');
            const statusText = order.status === 'preparing' ? 'Hazırlanıyor' : 'Hazırlandı';
            const statusClass = order.status === 'preparing' ? 'status-preparing' : 'status-ready';

            dom.currentOrderDisplay.innerHTML = `
                <p class="text-zinc-400 mb-2">Sipariş No: <span class="text-amber-500 font-bold">${order.orderId}</span></p>
                <div class="flex items-center justify-center space-x-2">
                    <span class="status-badge ${statusClass}">
                        ${statusText}
                    </span>
                    ${order.status === 'ready' ? '<span class="text-sm font-semibold text-emerald-500 ml-2">Lütfen siparişinizi teslim alın.</span>' : ''}
                </div>
            `;
            if (order.status === 'completed') {
                dom.orderStatusCard.classList.add('hidden');
            }
        }
        
        function placeOrder() {
            if (!selectedTable) {
                console.error("Masa numarası yok.");
                return;
            }
            const itemsInCart = Object.values(cart).filter(item => item.quantity > 0);
            if (itemsInCart.length === 0) return;

            const total = itemsInCart.reduce((sum, item) => sum + item.totalPrice, 0);
            
            const newOrder = {
                id: Date.now().toString(),
                tableNumber: selectedTable,
                status: 'preparing',
                items: itemsInCart,
                total: total,
                orderId: Math.random().toString(36).substring(2, 8).toUpperCase(),
                timestamp: new Date().toISOString()
            };
            
            localOrders.push(newOrder);
            saveToLocalStorage('orders', localOrders);
            lastPlacedOrderId = newOrder.id;
            saveToLocalStorage('last_order_id', lastPlacedOrderId);

            showOrderModal(newOrder.orderId);
            cart = {};
            updateCart();
            dom.orderButton.disabled = true;
            updateCustomerView();
        }

        function showOrderModal(orderId) {
            dom.orderSummaryList.innerHTML = '';
            let total = 0;
            const itemsInCart = Object.values(cart).filter(item => item.quantity > 0);

            itemsInCart.forEach(item => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="font-semibold font-montserrat">${item.name}</span> - ${item.quantity} adet <span class="float-right font-bold font-montserrat">${formatPrice(item.totalPrice)}</span>`;
                dom.orderSummaryList.appendChild(li);
                total += item.totalPrice;
            });

            document.getElementById('order-id').textContent = orderId;
            dom.orderTotalPriceEl.textContent = formatPrice(total);
            showModal(dom.orderModal);
        }
        
        // --- Olay Dinleyicileri ---
        document.addEventListener('DOMContentLoaded', () => {
            hideModal(dom.loaderOverlay);
            showModal(dom.tableModal);
        });

        dom.setTableBtn.addEventListener('click', () => {
            const tableNumber = dom.tableInput.value.trim();
            if (tableNumber) {
                selectedTable = tableNumber;
                dom.tableNumberText.textContent = selectedTable;
                dom.currentTableDisplay.classList.remove('hidden');
                hideModal(dom.tableModal);
                renderMenu('kahveler');
                updateCart();
                dom.callSupportBtn.disabled = false;
            }
        });

        dom.tabButtons.forEach(button => {
            button.addEventListener('click', () => {
                dom.tabButtons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                renderMenu(button.getAttribute('data-tab'));
            });
        });
        
        dom.customerViewBtn.addEventListener('click', () => setView('customer'));
        dom.staffViewBtn.addEventListener('click', () => showModal(dom.staffLoginModal));
        dom.closeLoginModal.addEventListener('click', () => hideModal(dom.staffLoginModal));

        dom.staffLoginBtn.addEventListener('click', () => {
            if (dom.staffPasswordInput.value === staffPassword) {
                setView('staff');
                hideModal(dom.staffLoginModal);
            } else {
                dom.loginMessageEl.classList.remove('hidden');
            }
        });

        dom.closeModalButton.addEventListener('click', () => {
            hideModal(dom.itemModal);
            selectedItem = null;
        });

        dom.increaseQuantityModalBtn.addEventListener('click', () => {
            selectedItemQuantity++;
            dom.modalQuantityEl.textContent = selectedItemQuantity;
            updateModalPrice();
        });

        dom.decreaseQuantityModalBtn.addEventListener('click', () => {
            if (selectedItemQuantity > 1) {
                selectedItemQuantity--;
                dom.modalQuantityEl.textContent = selectedItemQuantity;
                updateModalPrice();
            }
        });

        dom.addToCartButton.addEventListener('click', addToCart);

        dom.cartItemsList.addEventListener('click', (e) => {
            const btn = e.target.closest('button');
            if (!btn) return;
            
            const id = btn.getAttribute('data-id');
            const cartItem = cart[id];
            if (!cartItem) return;

            if (btn.classList.contains('increase-cart-btn')) {
                cartItem.quantity++;
            } else if (btn.classList.contains('decrease-cart-btn')) {
                cartItem.quantity--;
            }

            const optionsTotal = Object.values(cartItem.selectedOptions || {}).reduce((sum, opt) => sum + opt.price, 0);
            cartItem.totalPrice = (cartItem.price + optionsTotal) * cartItem.quantity;
            
            if (cartItem.quantity <= 0) {
                delete cart[id];
            }
            updateCart();
        });

        dom.orderButton.addEventListener('click', placeOrder);
        dom.closeOrderModal.addEventListener('click', () => hideModal(dom.orderModal));
        dom.closeReadyModalBtn.addEventListener('click', () => hideModal(dom.readyModal));

        dom.callSupportBtn.addEventListener('click', () => {
            if (selectedTable) {
                const newCall = {
                    id: Date.now().toString(),
                    tableNumber: selectedTable,
                    timestamp: new Date().toISOString()
                };
                localSupportCalls.push(newCall);
                saveToLocalStorage('support_calls', localSupportCalls);
                showModal(dom.supportCallSuccessModal);
                updateLocalData();
            }
        });

        dom.closeSupportModalBtn.addEventListener('click', () => hideModal(dom.supportCallSuccessModal));

        dom.staffView.addEventListener('click', (e) => {
            const btn = e.target.closest('button[data-action]');
            if (!btn) return;

            const itemId = btn.getAttribute('data-id');
            const action = btn.getAttribute('data-action');
            
            if (action === 'mark-as-ready') {
                const order = localOrders.find(o => o.id === itemId);
                if (order) order.status = 'ready';
            } else if (action === 'complete-order') {
                const order = localOrders.find(o => o.id === itemId);
                if (order) order.status = 'completed';
            } else if (action === 'resolve-support') {
                localSupportCalls = localSupportCalls.filter(call => call.id !== itemId);
            }
            
            saveToLocalStorage('orders', localOrders);
            saveToLocalStorage('support_calls', localSupportCalls);
            updateLocalData();
        });
    </script>
</body>
</html>
